# setequal(artdf, patients$id)
# vislftcntr$id[vislftcntr$id == 5080]
#
##  data analisis all #
cscall <- cascadedb %>% ### gender and agegrp and occupation
select(-regnum, -lastvdate, -visstt, -deathy, - regdate, -age, -rgy, -arvdate,
-vlrlat, -vdt, -lvvl, -arv23) %>%
#select(trroute, sex,  agect, VlonArt, vl) %>%
tbl_summary(#by =,
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscall)
# incare
cscincare <- cascadedb %>% ### gender and agegrp and occupation
select(vstcare, trroute, sex,  agect, onart) %>%
tbl_summary(by =vstcare,
# statistic = list(
#   all_continuous() ~ "{mean} ({sd})",
#   all_categorical() ~ "{n} ({p} %)"
# ),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscincare)
## cascade on ART
cscarv <- cascadedb %>% ### gender and agegrp and occupation
select(onart, sex, trroute, agect) %>%
tbl_summary(by = onart,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscarv)
7229/10762
## cascade done
cscvldone <- cascadedb %>% ### gender and agegrp and occupation
select(VlonDone, sex, trroute, agect) %>%
tbl_summary(by = VlonArt,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscartvl)
## cascqade vl under 1000
cscvl1000 <- cascadedb %>% ### gender and agegrp and occupation
select(vldund1000, sex, trroute, agect) %>%
tbl_summary(by = vldund1000,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscvl1000)
## cascqade vl under 200
cscvl200 <- cascadedb %>% ### gender and agegrp and occupation
select(vldund200, sex, trroute, agect) %>%
tbl_summary(by = vldund200,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
5748/7229
5341/7229
5341/5748
## cascqade vl under 200
cscvl200 <- cascadedb %>% ### gender and agegrp and occupation
select(vldund200, sex, trroute, agect) %>%
tbl_summary(by = vldund200,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscdbvl200)
## cascqade vl under 200
cscvl200 <- cascadedb %>% ### gender and agegrp and occupation
select(vldund200, sex, trroute, agect) %>%
tbl_summary(by = vldund200,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscdbvl200)
# arte <- cascade20 %>% filter(arv2020 == "y")
# artdf <-setdiff(art$id, arte$regnum)
# setequal(artdf, patients$id)
# vislftcntr$id[vislftcntr$id == 5080]
#
##  data analisis all #
cscall <- cascadedb %>% ### gender and agegrp and occupation
select(-regnum, -lastvdate, -visstt, -deathy, - regdate, -age, -rgy, -arvdate,
-vlrlat, -vdt, -lvvl, -arv23) %>%
#select(trroute, sex,  agect, VlonArt, vl) %>%
tbl_summary(#by =,
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscall)
# incare
cscincare <- cascadedb %>% ### gender and agegrp and occupation
select(vstcare, trroute, sex,  agect, onart) %>%
tbl_summary(by =vstcare,
# statistic = list(
#   all_continuous() ~ "{mean} ({sd})",
#   all_categorical() ~ "{n} ({p} %)"
# ),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscincare)
## cascade on ART
cscarv <- cascadedb %>% ### gender and agegrp and occupation
select(onart, sex, trroute, agect) %>%
tbl_summary(by = onart,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscarv)
## cascade done
cscvldone <- cascadedb %>% ### gender and agegrp and occupation
select(VlonDone, sex, trroute, agect) %>%
tbl_summary(by = VlonArt,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscartvl)
## cascade done
cscvldone <- cascadedb %>% ### gender and agegrp and occupation
select(VlonDone, sex, trroute, agect) %>%
tbl_summary(by = VlonArt,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscartvl)
## cascade done
cscvldone <- cascadedb %>% ### gender and agegrp and occupation
select(VlonDone, sex, trroute, agect) %>%
tbl_summary(by = VlonArt,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscvldone)
## cascade done
cscvldone <- cascadedb %>% ### gender and agegrp and occupation
select(VlonDone, sex, trroute, agect) %>%
tbl_summary(by = VlonDone,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscvldone)
## cascqade vl under 1000
cscvl1000 <- cascadedb %>% ### gender and agegrp and occupation
select(vldund1000, sex, trroute, agect) %>%
tbl_summary(by = vldund1000,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscvl1000)
## cascqade vl under 200
cscvl200 <- cascadedb %>% ### gender and agegrp and occupation
select(vldund200, sex, trroute, agect) %>%
tbl_summary(by = vldund200,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscdbvl200)
## cascqade vl under 200
cscvl200 <- cascadedb %>% ### gender and agegrp and occupation
select(vldund200, sex, trroute, agect) %>%
tbl_summary(by = vldund200,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscvl200)
arvdiffs %>%
ggplot(aes(x = rgy, y = arvdfd, color = trroute)) +
geom_line(lwd = 2) +
scale_x_continuous("Year", labels = as.character(latediangosisn$lry),
breaks = latediangosisn$lry)+
scale_y_continuous("Median (days)")+
theme_bw() +
labs(color = "Transmission") +
scale_color_manual(values = c(2:6)) +
theme(axis.text.x = element_text(angle = 90, colour = "black", size = 10),
axis.text.y = element_text(colour = "black", size = 10),
strip.text.x = element_text(colour = "black", size = 10),
legend.title = element_text(size = 20), #, face = "bold"
title = element_text(size = 20),
legend.text = element_text(size = 20),
axis.title.x = element_text(size = 15,  face = "bold"),
axis.title.y = element_text(size = 15,  face = "bold"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
##### import art ###
art <- read_excel("data/art2023.xlsx", sheet = "art2023") %>%
mutate(art2023d = paste0("y"), id = as.integer64(id))
glimpse(art)
artn <-dbarv %>%
filter(arvgdate >= '2023-12-01', arvgdate <= '2023-12-31', !is.na(id),
!(arvst %in% c(268, 302, 354, 357, 364, 539, 598, 626, 627))) %>%
mutate(arv23 = paste0("y")) %>%
arrange(id) %>%
select(id, arv23) %>%   unique()
setdiff(art$id, artn$id)
##### cascade coding ###
cascadedb <- hivdb %>%
left_join(vll, by = c("regnum" = "id")) %>% #
# mutate(id = as.numeric(regnum)) %>%
left_join(artn, by =  c("regnum" = "id")) %>%  # arv patient data
mutate(vstcare = ifelse(is.na(lastvdate), "NotIncare", "Incare"),
onart = ifelse(is.na(arv23), "NotART", "ART"),
VlonDone = ifelse(is.na(lvvl), "NonVL", "VLDone"))
glimpse(cascadedb)
names(cascadedb)
write.csv(cascadedb, paste(getwd(), "/data/cascadedb", Sys.Date(), ".csv", sep = ""), row.names=F, na="")
# arte <- cascade20 %>% filter(arv2020 == "y")
# artdf <-setdiff(art$id, arte$regnum)
# setequal(artdf, patients$id)
# vislftcntr$id[vislftcntr$id == 5080]
#
##  data analisis all #
cscall <- cascadedb %>% ### gender and agegrp and occupation
select(-regnum, -lastvdate, -visstt, -deathy, - regdate, -age, -rgy, -arvdate,
-vlrlat, -vdt, -lvvl, -arv23) %>%
#select(trroute, sex,  agect, VlonArt, vl) %>%
tbl_summary(#by =,
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscall)
# incare
cscincare <- cascadedb %>% ### gender and agegrp and occupation
select(vstcare, trroute, sex,  agect, onart) %>%
tbl_summary(by =vstcare,
# statistic = list(
#   all_continuous() ~ "{mean} ({sd})",
#   all_categorical() ~ "{n} ({p} %)"
# ),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscincare)
## cascade on ART
cscarv <- cascadedb %>% ### gender and agegrp and occupation
select(onart, sex, trroute, agect) %>%
tbl_summary(by = onart,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscarv)
## cascade done
cscvldone <- cascadedb %>% ### gender and agegrp and occupation
select(VlonDone, sex, trroute, agect) %>%
tbl_summary(by = VlonDone,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscvldone)
## cascqade vl under 1000
cscvl1000 <- cascadedb %>% ### gender and agegrp and occupation
select(vldund1000, sex, trroute, agect) %>%
tbl_summary(by = vldund1000,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscvl1000)
## cascqade vl under 200
cscvl200 <- cascadedb %>% ### gender and agegrp and occupation
select(vldund200, sex, trroute, agect) %>%
tbl_summary(by = vldund200,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscvl200)
## cascade done
cscvldone <- cascadedb %>% ### gender and agegrp and occupation
select(VlonDone, sex, trroute, agect, vldund1000, vldund200) %>%
tbl_summary(by = VlonDone,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscvldone)
## cascade done
cscvldone <- cascadedb %>% ### gender and agegrp and occupation
select(VlonDone, sex, trroute, agect, vldund1000, vldund200) %>%
tbl_summary(by = VlonDone,
percent = "col",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscvldone)
## cascade done
cscvldone <- cascadedb %>% ### gender and agegrp and occupation
select(VlonDone, sex, trroute, agect, vldund1000, vldund200) %>%
tbl_summary(by = VlonDone,
percent = "column",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscvldone)
## cascade done
cscvldone <- cascadedb %>% ### gender and agegrp and occupation
select(VlonDone, sex, trroute, agect, vldund1000, vldund200, onart) %>%
tbl_summary(by = VlonDone,
percent = "column",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscvldone)
# incare
cscincare <- cascadedb %>% ### gender and agegrp and occupation
select(vstcare, trroute, sex,  agect, onart) %>%
tbl_summary(by =vstcare,
# statistic = list(
#   all_continuous() ~ "{mean} ({sd})",
#   all_categorical() ~ "{n} ({p} %)"
# ),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscincare)
# incare
cscincare <- cascadedb %>% ### gender and agegrp and occupation
select(vstcare, trroute, sex,  agect, onart, VlonDone, vldund1000, vldund200) %>%
tbl_summary(by =vstcare,
# statistic = list(
#   all_continuous() ~ "{mean} ({sd})",
#   all_categorical() ~ "{n} ({p} %)"
# ),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscincare)
## cascade on ART
cscarv <- cascadedb %>% ### gender and agegrp and occupation
select(onart, sex, trroute, agect) %>%
tbl_summary(by = onart,
percent = "row",
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} ({p} %)"
),
#label = q2 ~ "ასაკ. ჯგ.",
missing_text = "Unk.")
as_flex_table(cscarv)
## prds code
rm(list=ls())  # remove all data
dev.off()
print(sessionInfo(), l=F)
## packages
## load packages
ipak <- function(pkg){
new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
if (length(new.pkg))
install.packages(new.pkg, dependencies = TRUE)
sapply(pkg, require, character.only = TRUE)
}
# usage
packages <- c("installr", "RPostgres", "dplyr","lubridate",
"ggplot2","tidyr", "DBI", "gtsummary", "openxlsx",
"readxl","readr", "pdftools", "janitor",
"stringr", "gtools", "emayili", "bit64")
ipak(packages)
### set wirking directory
workwd <- "~/ICAP/Tranining materials/PRDS Georgia/gripebi"
homewd <- "~/OTO/Projects/ICAP/Tranining materials/PRDS Georgia/gripebi"
if(isTRUE(file.info(workwd) [1,"isdir"])){
setwd(workwd);dir() # dir.create is used to creatge not existing directory
}else{
(isTRUE(file.info(homewd)[1,"isdir"]))
setwd(homewd);dir()
}
## read data
gripiepid <- read_excel("data/finaleidss.xlsx", sheet = "eidss", header=T)
## read data
gripiepid <- read_excel("data/finaleidss.xlsx", sheet = "eidss")
workwd <- "~/ICAP/Tranining materials/PRDS Georgia/gripebi"
homewd <- "~/OTO/Projects/ICAP/Tranining materials/PRDS Georgia/gripebi"
if(isTRUE(file.info(workwd) [1,"isdir"])){
setwd(workwd);dir() # dir.create is used to creatge not existing directory
}else{
(isTRUE(file.info(homewd)[1,"isdir"]))
setwd(homewd);dir()
}
### set wirking directory
workwd <- "~/OTO/ICAP/Tranining materials/PRDS Georgia/gripebi"
homewd <- "~/OTO/Projects/ICAP/Tranining materials/PRDS Georgia/gripebi"
if(isTRUE(file.info(workwd) [1,"isdir"])){
setwd(workwd);dir() # dir.create is used to creatge not existing directory
}else{
(isTRUE(file.info(homewd)[1,"isdir"]))
setwd(homewd);dir()
}
getwd()
## prds code
rm(list=ls())  # remove all data
dev.off()
print(sessionInfo(), l=F)
## packages
## load packages
ipak <- function(pkg){
new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
if (length(new.pkg))
install.packages(new.pkg, dependencies = TRUE)
sapply(pkg, require, character.only = TRUE)
}
# usage
packages <- c("installr", "RPostgres", "dplyr","lubridate",
"ggplot2","tidyr", "DBI", "gtsummary", "openxlsx",
"readxl","readr", "pdftools", "janitor",
"stringr", "gtools", "emayili", "bit64")
ipak(packages)
## load packages
ipak <- function(pkg){
new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
if (length(new.pkg))
install.packages(new.pkg, dependencies = TRUE)
sapply(pkg, require, character.only = TRUE)
}
# usage
packages <- c("installr", "RPostgreSQL", "RPostgres", "dplyr","lubridate","ggplot2","tidyr",
"readxl","readr")
epiweek(today())
epiweek(now())
library(lubridate)
epiweek(now())
week()
week(now())
?epiweek
