panel.grid.minor = element_blank()
)
arvdiffs <- hivdb %>%
mutate(arvdiffdays = as.duration(interval(regdate, arvdate)) %/% as.duration(days(1)),
ary = year(arvdate)) %>%
filter(is.na(deathy), regdate > '2010-01-01', !(trroute %in% c("OTHER")), arvdiffdays >= 0, arvdiffdays <= 1000) %>%
arvdiffs <- hivdb %>%
mutate(arvdiffdays = as.duration(interval(regdate, arvdate)) %/% as.duration(days(1)),
ary = year(arvdate)) %>%
filter(is.na(deathy), regdate > '2010-01-01', !(trroute %in% c("OTHER")), arvdiffdays >= 0, arvdiffdays <= 1000)
### ART start wfter HIv diagnosis
arvdiffs <- hivdb %>%
mutate(arvdiffdays = as.duration(interval(regdate, arvdate)) %/% as.duration(days(1)),
ary = year(arvdate)) %>%
filter(is.na(deathy), regdate > '2010-01-01', !(trroute %in% c("OTHER")), arvdiffdays >= 0, arvdiffdays <= 1000) %>%
group_by(ary, trroute) %>%
summarise(arvdfd = mean(arvdiffdays)) %>%
ungroup()
arvdiffs %>%
ggplot(aes(x = ary, y = arvdfd, color = trroute)) +
geom_line(lwd = 2)+
scale_x_continuous("Year", labels = as.character(latediangosisn$lry),
breaks = latediangosisn$lry)+
scale_y_continuous("Percent")+
theme_bw() +
labs(color = "transmission") +
scale_color_manual(values = c(2:6)) +
theme(axis.text.x = element_text(angle = 90, colour = "black", size = 10),
axis.text.y = element_text(colour = "black", size = 10),
strip.text.x = element_text(colour = "black", size = 10),
legend.title = element_text(size = 20), #, face = "bold"
title = element_text(size = 20),
legend.text = element_text(size = 20),
axis.title.x = element_text(size = 15,  face = "bold"),
axis.title.y = element_text(size = 15,  face = "bold"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
arvdiffs <- hivdb %>%
mutate(arvdiffdays = as.duration(interval(regdate, arvdate)) %/% as.duration(days(1)),
ary = year(arvdate)) %>%
filter(is.na(deathy), regdate > '2010-01-01', !(trroute %in% c("OTHER")),
arvdiffdays >= 0, arvdiffdays <= 1000)
### ART start wfter HIv diagnosis
arvdiffs <- hivdb %>%
mutate(arvdiffdays = as.duration(interval(regdate, arvdate)) %/% as.duration(days(1)),
ary = year(arvdate)) %>%
filter(is.na(deathy), regdate > '2010-01-01', !(trroute %in% c("OTHER")),
arvdiffdays >= 0, arvdiffdays <= 1000) %>%
group_by(rgy, trroute) %>%
summarise(arvdfd = mean(arvdiffdays)) %>%
ungroup()
arvdiffs %>%
ggplot(aes(x = rgy, y = arvdfd, color = trroute)) +
geom_line(lwd = 2)+
scale_x_continuous("Year", labels = as.character(latediangosisn$lry),
breaks = latediangosisn$lry)+
scale_y_continuous("Percent")+
theme_bw() +
labs(color = "transmission") +
scale_color_manual(values = c(2:6)) +
theme(axis.text.x = element_text(angle = 90, colour = "black", size = 10),
axis.text.y = element_text(colour = "black", size = 10),
strip.text.x = element_text(colour = "black", size = 10),
legend.title = element_text(size = 20), #, face = "bold"
title = element_text(size = 20),
legend.text = element_text(size = 20),
axis.title.x = element_text(size = 15,  face = "bold"),
axis.title.y = element_text(size = 15,  face = "bold"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
### ART start wfter HIv diagnosis
arvdiffs <- hivdb %>%
mutate(arvdiffdays = as.duration(interval(regdate, arvdate)) %/% as.duration(days(1)),
ary = year(arvdate)) %>%
filter(is.na(deathy), regdate > '2015-01-01', !(trroute %in% c("OTHER")),
arvdiffdays >= 0, arvdiffdays <= 1000) %>%
group_by(rgy, trroute) %>%
summarise(arvdfd = mean(arvdiffdays)) %>%
ungroup()
arvdiffs %>%
ggplot(aes(x = rgy, y = arvdfd, color = trroute)) +
geom_line(lwd = 2)+
scale_x_continuous("Year", labels = as.character(latediangosisn$lry),
breaks = latediangosisn$lry)+
scale_y_continuous("Percent")+
theme_bw() +
labs(color = "transmission") +
scale_color_manual(values = c(2:6)) +
theme(axis.text.x = element_text(angle = 90, colour = "black", size = 10),
axis.text.y = element_text(colour = "black", size = 10),
strip.text.x = element_text(colour = "black", size = 10),
legend.title = element_text(size = 20), #, face = "bold"
title = element_text(size = 20),
legend.text = element_text(size = 20),
axis.title.x = element_text(size = 15,  face = "bold"),
axis.title.y = element_text(size = 15,  face = "bold"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
### ART start wfter HIv diagnosis
arvdiffs <- hivdb %>%
mutate(arvdiffdays = as.duration(interval(regdate, arvdate)) %/% as.duration(days(1)),
ary = year(arvdate)) %>%
filter(is.na(deathy), regdate > '2019-01-01', !(trroute %in% c("OTHER")),
arvdiffdays >= 0, arvdiffdays <= 1000) %>%
group_by(rgy, trroute) %>%
summarise(arvdfd = mean(arvdiffdays)) %>%
ungroup()
arvdiffs %>%
ggplot(aes(x = rgy, y = arvdfd, color = trroute)) +
geom_line(lwd = 2)+
scale_x_continuous("Year", labels = as.character(latediangosisn$lry),
breaks = latediangosisn$lry)+
scale_y_continuous("Percent")+
theme_bw() +
labs(color = "transmission") +
scale_color_manual(values = c(2:6)) +
theme(axis.text.x = element_text(angle = 90, colour = "black", size = 10),
axis.text.y = element_text(colour = "black", size = 10),
strip.text.x = element_text(colour = "black", size = 10),
legend.title = element_text(size = 20), #, face = "bold"
title = element_text(size = 20),
legend.text = element_text(size = 20),
axis.title.x = element_text(size = 15,  face = "bold"),
axis.title.y = element_text(size = 15,  face = "bold"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
### ART start wfter HIv diagnosis
arvdiffs <- hivdb %>%
mutate(arvdiffdays = as.duration(interval(regdate, arvdate)) %/% as.duration(days(1)),
ary = year(arvdate)) %>%
filter(is.na(deathy), regdate > '2015-01-01', !(trroute %in% c("OTHER")),
arvdiffdays >= 0, arvdiffdays <= 1000) %>%
group_by(rgy, trroute) %>%
summarise(arvdfd = median(arvdiffdays)) %>%
ungroup()
arvdiffs %>%
ggplot(aes(x = rgy, y = arvdfd, color = trroute)) +
geom_line(lwd = 2)+
scale_x_continuous("Year", labels = as.character(latediangosisn$lry),
breaks = latediangosisn$lry)+
scale_y_continuous("Percent")+
theme_bw() +
labs(color = "transmission") +
scale_color_manual(values = c(2:6)) +
theme(axis.text.x = element_text(angle = 90, colour = "black", size = 10),
axis.text.y = element_text(colour = "black", size = 10),
strip.text.x = element_text(colour = "black", size = 10),
legend.title = element_text(size = 20), #, face = "bold"
title = element_text(size = 20),
legend.text = element_text(size = 20),
axis.title.x = element_text(size = 15,  face = "bold"),
axis.title.y = element_text(size = 15,  face = "bold"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
### ART start wfter HIv diagnosis
arvdiffs <- hivdb %>%
mutate(arvdiffdays = as.duration(interval(regdate, arvdate)) %/% as.duration(days(1)),
ary = year(arvdate)) %>%
filter(is.na(deathy), regdate > '2018-01-01', !(trroute %in% c("OTHER")),
arvdiffdays >= 0, arvdiffdays <= 1000) %>%
group_by(rgy, trroute) %>%
summarise(arvdfd = median(arvdiffdays)) %>%
ungroup()
arvdiffs %>%
ggplot(aes(x = rgy, y = arvdfd, color = trroute)) +
geom_line(lwd = 2)+
scale_x_continuous("Year", labels = as.character(latediangosisn$lry),
breaks = latediangosisn$lry)+
scale_y_continuous("Percent")+
theme_bw() +
labs(color = "transmission") +
scale_color_manual(values = c(2:6)) +
theme(axis.text.x = element_text(angle = 90, colour = "black", size = 10),
axis.text.y = element_text(colour = "black", size = 10),
strip.text.x = element_text(colour = "black", size = 10),
legend.title = element_text(size = 20), #, face = "bold"
title = element_text(size = 20),
legend.text = element_text(size = 20),
axis.title.x = element_text(size = 15,  face = "bold"),
axis.title.y = element_text(size = 15,  face = "bold"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
### ART start wfter HIv diagnosis
arvdiffs <- hivdb %>%
mutate(arvdiffdays = as.duration(interval(regdate, arvdate)) %/% as.duration(days(1)),
ary = year(arvdate)) %>%
filter(is.na(deathy), regdate > '2018-01-01', !(trroute %in% c("OTHER")),
arvdiffdays >= 0) %>%
group_by(rgy, trroute) %>%
summarise(arvdfd = median(arvdiffdays)) %>%
ungroup()
arvdiffs %>%
ggplot(aes(x = rgy, y = arvdfd, color = trroute)) +
geom_line(lwd = 2)+
scale_x_continuous("Year", labels = as.character(latediangosisn$lry),
breaks = latediangosisn$lry)+
scale_y_continuous("Percent")+
theme_bw() +
labs(color = "transmission") +
scale_color_manual(values = c(2:6)) +
theme(axis.text.x = element_text(angle = 90, colour = "black", size = 10),
axis.text.y = element_text(colour = "black", size = 10),
strip.text.x = element_text(colour = "black", size = 10),
legend.title = element_text(size = 20), #, face = "bold"
title = element_text(size = 20),
legend.text = element_text(size = 20),
axis.title.x = element_text(size = 15,  face = "bold"),
axis.title.y = element_text(size = 15,  face = "bold"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
### ART start wfter HIv diagnosis
arvdiffs <- hivdb %>%
mutate(arvdiffdays = as.duration(interval(regdate, arvdate)) %/% as.duration(days(1)),
ary = year(arvdate)) %>%
filter(is.na(deathy), regdate > '2014-01-01', !(trroute %in% c("OTHER")),
arvdiffdays >= 0) %>%
group_by(rgy, trroute) %>%
summarise(arvdfd = median(arvdiffdays)) %>%
ungroup()
arvdiffs %>%
ggplot(aes(x = rgy, y = arvdfd, color = trroute)) +
geom_line(lwd = 2)+
scale_x_continuous("Year", labels = as.character(latediangosisn$lry),
breaks = latediangosisn$lry)+
scale_y_continuous("Percent")+
theme_bw() +
labs(color = "transmission") +
scale_color_manual(values = c(2:6)) +
theme(axis.text.x = element_text(angle = 90, colour = "black", size = 10),
axis.text.y = element_text(colour = "black", size = 10),
strip.text.x = element_text(colour = "black", size = 10),
legend.title = element_text(size = 20), #, face = "bold"
title = element_text(size = 20),
legend.text = element_text(size = 20),
axis.title.x = element_text(size = 15,  face = "bold"),
axis.title.y = element_text(size = 15,  face = "bold"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
### ART start wfter HIv diagnosis
arvdiffs <- hivdb %>%
mutate(arvdiffdays = as.duration(interval(regdate, arvdate)) %/% as.duration(days(1)),
ary = year(arvdate)) %>%
filter(is.na(deathy), regdate > '2017-01-01', !(trroute %in% c("OTHER")),
arvdiffdays >= 0) %>%
group_by(rgy, trroute) %>%
summarise(arvdfd = median(arvdiffdays)) %>%
ungroup()
arvdiffs %>%
ggplot(aes(x = rgy, y = arvdfd, color = trroute)) +
geom_line(lwd = 2)+
scale_x_continuous("Year", labels = as.character(latediangosisn$lry),
breaks = latediangosisn$lry)+
scale_y_continuous("Percent")+
theme_bw() +
labs(color = "transmission") +
scale_color_manual(values = c(2:6)) +
theme(axis.text.x = element_text(angle = 90, colour = "black", size = 10),
axis.text.y = element_text(colour = "black", size = 10),
strip.text.x = element_text(colour = "black", size = 10),
legend.title = element_text(size = 20), #, face = "bold"
title = element_text(size = 20),
legend.text = element_text(size = 20),
axis.title.x = element_text(size = 15,  face = "bold"),
axis.title.y = element_text(size = 15,  face = "bold"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
### ART start wfter HIv diagnosis
arvdiffs <- hivdb %>%
mutate(arvdiffdays = as.duration(interval(regdate, arvdate)) %/% as.duration(days(1)),
ary = year(arvdate)) %>%
filter(is.na(deathy), regdate > '2015-01-01', !(trroute %in% c("OTHER")),
arvdiffdays >= 0) %>%
group_by(rgy, trroute) %>%
summarise(arvdfd = median(arvdiffdays)) %>%
ungroup()
arvdiffs %>%
ggplot(aes(x = rgy, y = arvdfd, color = trroute)) +
geom_line(lwd = 2)+
scale_x_continuous("Year", labels = as.character(latediangosisn$lry),
breaks = latediangosisn$lry)+
scale_y_continuous("Percent")+
theme_bw() +
labs(color = "transmission") +
scale_color_manual(values = c(2:6)) +
theme(axis.text.x = element_text(angle = 90, colour = "black", size = 10),
axis.text.y = element_text(colour = "black", size = 10),
strip.text.x = element_text(colour = "black", size = 10),
legend.title = element_text(size = 20), #, face = "bold"
title = element_text(size = 20),
legend.text = element_text(size = 20),
axis.title.x = element_text(size = 15,  face = "bold"),
axis.title.y = element_text(size = 15,  face = "bold"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
arvdiffs %>%
ggplot(aes(x = rgy, y = arvdfd, color = trroute)) +
geom_line(lwd = 2)+
scale_x_continuous("Year", labels = as.character(latediangosisn$lry),
breaks = latediangosisn$lry)+
scale_y_continuous("Median (days)")+
theme_bw() +
labs(color = "Transmission") +
scale_color_manual(values = c(2:6)) +
theme(axis.text.x = element_text(angle = 90, colour = "black", size = 10),
axis.text.y = element_text(colour = "black", size = 10),
strip.text.x = element_text(colour = "black", size = 10),
legend.title = element_text(size = 20), #, face = "bold"
title = element_text(size = 20),
legend.text = element_text(size = 20),
axis.title.x = element_text(size = 15,  face = "bold"),
axis.title.y = element_text(size = 15,  face = "bold"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
### ART start wfter HIv diagnosis
arvdiffs <- hivdb %>%
mutate(arvdiffdays = as.duration(interval(regdate, arvdate)) %/% as.duration(days(1)),
ary = year(arvdate)) %>%
filter(is.na(deathy), regdate > '2018-01-01', !(trroute %in% c("OTHER")),
arvdiffdays >= 0) %>%
group_by(rgy, trroute) %>%
summarise(arvdfd = median(arvdiffdays)) %>%
ungroup()
arvdiffs %>%
ggplot(aes(x = rgy, y = arvdfd, color = trroute)) +
geom_line(lwd = 2)+
scale_x_continuous("Year", labels = as.character(latediangosisn$lry),
breaks = latediangosisn$lry)+
scale_y_continuous("Median (days)")+
theme_bw() +
labs(color = "Transmission") +
scale_color_manual(values = c(2:6)) +
theme(axis.text.x = element_text(angle = 90, colour = "black", size = 10),
axis.text.y = element_text(colour = "black", size = 10),
strip.text.x = element_text(colour = "black", size = 10),
legend.title = element_text(size = 20), #, face = "bold"
title = element_text(size = 20),
legend.text = element_text(size = 20),
axis.title.x = element_text(size = 15,  face = "bold"),
axis.title.y = element_text(size = 15,  face = "bold"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
### ART start wfter HIv diagnosis
arvdiffs <- hivdb %>%
mutate(arvdiffdays = as.duration(interval(regdate, arvdate)) %/% as.duration(days(1)),
ary = year(arvdate)) %>%
filter(is.na(deathy), regdate > '2016-01-01', !(trroute %in% c("OTHER")),
arvdiffdays >= 0) %>%
group_by(rgy, trroute) %>%
summarise(arvdfd = median(arvdiffdays)) %>%
ungroup()
arvdiffs %>%
ggplot(aes(x = rgy, y = arvdfd, color = trroute)) +
geom_line(lwd = 2)+
scale_x_continuous("Year", labels = as.character(latediangosisn$lry),
breaks = latediangosisn$lry)+
scale_y_continuous("Median (days)")+
theme_bw() +
labs(color = "Transmission") +
scale_color_manual(values = c(2:6)) +
theme(axis.text.x = element_text(angle = 90, colour = "black", size = 10),
axis.text.y = element_text(colour = "black", size = 10),
strip.text.x = element_text(colour = "black", size = 10),
legend.title = element_text(size = 20), #, face = "bold"
title = element_text(size = 20),
legend.text = element_text(size = 20),
axis.title.x = element_text(size = 15,  face = "bold"),
axis.title.y = element_text(size = 15,  face = "bold"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
### ART start wfter HIv diagnosis
arvdiffs <- hivdb %>%
mutate(arvdiffdays = as.duration(interval(regdate, arvdate)) %/% as.duration(days(1)),
ary = year(arvdate)) %>%
filter(is.na(deathy), regdate > '2015-01-01', !(trroute %in% c("OTHER")),
arvdiffdays >= 0) %>%
group_by(rgy, trroute) %>%
summarise(arvdfd = median(arvdiffdays)) %>%
ungroup()
arvdiffs %>%
ggplot(aes(x = rgy, y = arvdfd, color = trroute)) +
geom_line(lwd = 2)+
scale_x_continuous("Year", labels = as.character(latediangosisn$lry),
breaks = latediangosisn$lry)+
scale_y_continuous("Median (days)")+
theme_bw() +
labs(color = "Transmission") +
scale_color_manual(values = c(2:6)) +
theme(axis.text.x = element_text(angle = 90, colour = "black", size = 10),
axis.text.y = element_text(colour = "black", size = 10),
strip.text.x = element_text(colour = "black", size = 10),
legend.title = element_text(size = 20), #, face = "bold"
title = element_text(size = 20),
legend.text = element_text(size = 20),
axis.title.x = element_text(size = 15,  face = "bold"),
axis.title.y = element_text(size = 15,  face = "bold"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
arvdiffs %>%
ggplot(aes(x = rgy, y = arvdfd, color = trroute)) +
geom_line(lwd = 2)+
scale_x_continuous("Year", labels = as.character(latediangosisn$lry),
breaks = latediangosisn$lry)+
scale_y_continuous("Median (days)")+
theme_bw() +
labs(color = "Transmission") +
scale_color_manual(values = c(2:6)) +
theme(axis.text.x = element_text(angle = 90, colour = "black", size = 10),
axis.text.y = element_text(colour = "black", size = 10),
strip.text.x = element_text(colour = "black", size = 10),
legend.title = element_text(size = 20), #, face = "bold"
title = element_text(size = 20),
legend.text = element_text(size = 20),
axis.title.x = element_text(size = 15,  face = "bold"),
axis.title.y = element_text(size = 15,  face = "bold"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank()
)
## cascade code
rm(list=ls())  # remove all data
dev.off()
print(sessionInfo(), l=F)
## packages
## load packages
ipak <- function(pkg){
new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
if (length(new.pkg))
install.packages(new.pkg, dependencies = TRUE)
sapply(pkg, require, character.only = TRUE)
}
# usage
packages <- c("installr", "RPostgres", "dplyr","lubridate","ggplot2","tidyr", "DBI",
"readxl","readr", "pdftools", "stringr", "gtools", "emayili")
ipak(packages)
### set wirking directory
workwd <- "~/OTO/Oficial/DB/HIVcascade"
homewd <- "/Users/oto/Documents/OTO/DB/HIVcascade"
if(isTRUE(file.info(workwd) [1,"isdir"])){
setwd(workwd);dir() # dir.create is used to creatge not existing directory
}else{
(isTRUE(file.info(homewd)[1,"isdir"]))
setwd(homewd);dir()
}
getwd()
### import from postgreslq
source("Connect_to_PGSQL.R") # load data from postgresql, you should enter database name
### import from postgreslq
source("Connect_to_PGSQL.R") # load data from postgresql, you should enter database name
### import from postgreslq
source("Connect_to_PGSQL.R") # load data from postgresql, you should enter database name
## cascade code
rm(list=ls())  # remove all data
dev.off()
print(sessionInfo(), l=F)
## packages
## load packages
ipak <- function(pkg){
new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
if (length(new.pkg))
install.packages(new.pkg, dependencies = TRUE)
sapply(pkg, require, character.only = TRUE)
}
# usage
packages <- c("installr", "RPostgres", "dplyr","lubridate","ggplot2","tidyr", "DBI",
"readxl","readr", "pdftools", "stringr", "gtools", "emayili")
ipak(packages)
### set wirking directory
workwd <- "~/OTO/Oficial/DB/HIVcascade"
homewd <- "/Users/oto/Documents/OTO/DB/HIVcascade"
if(isTRUE(file.info(workwd) [1,"isdir"])){
setwd(workwd);dir() # dir.create is used to creatge not existing directory
}else{
(isTRUE(file.info(homewd)[1,"isdir"]))
setwd(homewd);dir()
}
getwd()
### import from postgreslq
source("Connect_to_PGSQL.R") # load data from postgresql, you should enter database name
ipak <- function(pkg){
new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
if (length(new.pkg))
install.packages(new.pkg, dependencies = TRUE)
sapply(pkg, require, character.only = TRUE)
}
# usage
packages <- c("RPostgres", "DBI")
ipak(packages)
# ### import from postgreslq
# dbnm <- readline(prompt="Enter a DBname: ")
# userr<- readline(prompt="Enter a Username: ")
# psw <- readline(prompt="Enter a password: ")
#con<-dbConnect(PostgreSQL(), user=userr, password=psw, dbname=dbnm)  # connect to postgresql local db aidshis##date
# Connect to postgres database
con <- DBI::dbConnect(RPostgres::Postgres(),
dbname = rstudioapi::askForSecret("dbname"),
host = "localhost",
port = 5432,
user = rstudioapi::askForSecret("username"),
password = rstudioapi::askForSecret("dbpassword")) ## - use this code for dialog window# "oto2213"
